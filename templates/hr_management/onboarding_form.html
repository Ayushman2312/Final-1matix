{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <title>Complete Your Onboarding | {{ invitation.company.company_name }}</title>
    {% comment %} <link rel="icon" href="{% static 'images/favicon.ico' %}" type="image/x-icon"> {% endcomment %}
    <style>
        :root {
            --primary-color: #4F46E5;
            --primary-hover: #4338CA;
            --secondary-color: #06B6D4;
            --bg-color: #F9FAFB;
            --success-color: #10B981;
            --text-color: #1F2937;
            --text-light: #6B7280;
            --border-color: #E5E7EB;
            --card-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        body {
            background-color: var(--bg-color);
            font-family: 'Poppins', sans-serif;
            color: var(--text-color);
        }
        .welcome-banner {
            background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%);
            border-radius: 20px;
            padding: 2.5rem;
            margin-bottom: 2.5rem;
            color: white;
            box-shadow: var(--card-shadow);
        }
        .form-step {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .form-step.active {
            display: block;
        }
        .step-indicator {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            padding-left: 2.5rem;
            margin-bottom: 1.5rem;
            cursor: pointer;
            font-weight: 500;
        }
        .step-indicator::before {
            content: '';
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background-color: #E5E7EB;
            transition: all 0.4s ease;
        }
        .step-indicator.active::before {
            background-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.2);
        }
        .form-card {
            background: white;
            border-radius: 20px;
            box-shadow: var(--card-shadow);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        /* Enhanced input styling */
        input[type="text"],
        input[type="email"],
        input[type="password"],
        input[type="tel"],
        input[type="date"],
        input[type="number"],
        textarea,
        select {
            @apply block w-full px-4 py-3.5 rounded-xl border border-gray-300 
            shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500
            transition duration-200 ease-in-out;
            background-color: #FFFFFF;
            font-size: 0.95rem;
            color: #374151;
        }
        input[type="text"]:hover,
        input[type="email"]:hover,
        input[type="password"]:hover,
        input[type="tel"]:hover,
        input[type="date"]:hover,
        input[type="number"]:hover,
        textarea:hover,
        select:hover {
            @apply border-indigo-300 shadow-md;
            background-color: #F9FAFB;
        }
        input[type="text"]:focus,
        input[type="email"]:focus,
        input[type="password"]:focus,
        input[type="tel"]:focus,
        input[type="date"]:focus,
        input[type="number"]:focus,
        textarea:focus,
        select:focus {
            @apply outline-none border-indigo-500 ring-2 ring-indigo-200;
            background-color: #FFFFFF;
        }
        /* Label enhancements */
        label {
            @apply block text-sm font-medium text-gray-700 mb-1.5;
            letter-spacing: 0.01em;
        }
        /* Input group styling */
        .input-group {
            @apply relative rounded-xl shadow-sm;
        }
        .input-group input {
            @apply pl-10;
        }
        /* Error state */
        input.error, select.error, textarea.error {
            @apply border-red-500 focus:ring-red-200 focus:border-red-500 bg-red-50;
        }
        .error-message {
            @apply text-red-600 text-xs mt-1 font-medium;
        }
        /* Success state */
        input.success, select.success, textarea.success {
            @apply border-green-500 focus:ring-green-200 focus:border-green-500 bg-green-50;
        }
        /* Readonly state */
        input[readonly] {
            @apply bg-gray-50 text-gray-600 cursor-not-allowed border-gray-200;
        }
        .btn-primary {
            @apply px-7 py-3.5 bg-indigo-600 text-white rounded-xl font-medium shadow-lg 
            hover:bg-indigo-700 transform transition-all duration-300 hover:scale-105 
            focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2;
            background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%);
        }
        .btn-secondary {
            @apply px-7 py-3.5 bg-gray-100 text-gray-700 rounded-xl font-medium shadow-md 
            hover:bg-gray-200 transform transition-all duration-300 hover:scale-105 
            focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2;
            border: 1px solid #E5E7EB;
        }
        .form-section-title {
            @apply text-xl font-semibold text-gray-800 mb-6;
            position: relative;
            padding-bottom: 0.75rem;
        }
        .form-section-title:after {
            content: '';
            position: absolute;
            left: 0;
            bottom: 0;
            width: 60px;
            height: 3px;
            background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%);
            border-radius: 3px;
        }
        .form-container {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            border-radius: 24px;
            overflow: hidden;
        }
        input[type="file"] {
            @apply block w-full text-sm text-gray-500 file:mr-4 file:py-2.5 file:px-4 
            file:rounded-xl file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 
            file:text-indigo-700 hover:file:bg-indigo-100 cursor-pointer focus:outline-none;
        }
    </style>
</head>
<body class="min-h-screen py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-7xl mx-auto">
        <!-- Welcome Modal -->
        <div id="welcomeModal" class="fixed inset-0 bg-black bg-opacity-60 backdrop-filter backdrop-blur-sm flex items-center justify-center z-50">
            <div class="welcome-banner max-w-3xl mx-4 relative">
                <h1 class="text-3xl font-bold mb-6">Welcome to {{ invitation.company.company_name }} Onboarding!</h1>
                <p class="text-[16px] opacity-90 mb-6 font-light">Please ensure you have the following information ready before completing your onboarding:</p>
                <div class="bg-white/10 rounded-xl p-5 space-y-4 backdrop-filter backdrop-blur-sm">
                    <div class="text-sm font-light flex items-start gap-3">
                        <svg class="w-5 h-5 mt-0.5 flex-shrink-0 text-indigo-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                        </svg>
                        <span class="leading-relaxed">Personal Information - Full Name, Contact Details, and Address</span>
                    </div>
                    <div class="text-sm font-light flex items-start gap-3">
                        <svg class="w-5 h-5 mt-0.5 flex-shrink-0 text-indigo-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                        </svg>
                        <span class="leading-relaxed">Education and Professional Information - Qualifications and Previous Work Experience</span>
                    </div>
                    <div class="text-sm font-light flex items-start gap-3">
                        <svg class="w-5 h-5 mt-0.5 flex-shrink-0 text-indigo-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                        </svg>
                        <span class="leading-relaxed">Emergency Contact Details - Name, Relationship, and Contact Information</span>
                    </div>
                    <div class="text-sm font-light flex items-start gap-3">
                        <svg class="w-5 h-5 mt-0.5 flex-shrink-0 text-indigo-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                        </svg>
                        <span class="leading-relaxed">Digital Copy of Resume/CV and ID Documents for Upload</span>
                    </div>
                </div>
                <div class="mt-8 flex gap-4">
                    <button onclick="closeWelcomeModal()" class="flex-1 bg-white text-indigo-800 font-semibold py-4 px-6 rounded-xl hover:bg-opacity-90 transition duration-200 transform hover:scale-105 shadow-lg">
                        I'm ready to proceed
                    </button>
                    {% comment %} <button id="rejectButton" class="flex-1 bg-white/10 text-white border border-white/20 font-semibold py-4 px-6 rounded-xl hover:bg-white/20 transition duration-200 transform hover:scale-105">
                        Decline Invitation
                    </button> {% endcomment %}
                </div>
            </div>
        </div>
        
        <!-- Main content card (hidden initially) -->
        <div id="onboardingFormContainer" class="form-container flex flex-col md:flex-row overflow-hidden hidden bg-white">
            <!-- Progress Sidebar -->
            <div class="w-full md:w-80 bg-gray-50 p-8 border-r border-gray-200">
                <div class="sticky top-8">
                    <h2 class="text-xl font-bold text-gray-800 mb-10 flex items-center">
                        <svg class="w-6 h-6 mr-2 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path>
                        </svg>
                        Your Progress
                    </h2>
                    <div class="space-y-6">
                        <div class="step-indicator active text-gray-900 font-medium" data-step="1">
                            Personal Information
                        </div>
                        <div class="step-indicator text-gray-600" data-step="2">
                            Employment Details
                        </div>
                        <div class="step-indicator text-gray-600" data-step="3">
                            Education & Experience
                        </div>
                        <div class="step-indicator text-gray-600" data-step="4">
                            Emergency Contacts
                        </div>
                        <div class="step-indicator text-gray-600" data-step="5">
                            Document Upload
                        </div>
                        <div class="step-indicator text-gray-600" data-step="6">
                            Review & Submit
                        </div>
                    </div>
                </div>
            </div>

            <!-- Form Content -->
            <div class="flex-1 p-6 md:p-12 overflow-y-auto">
                <div class="max-w-3xl mx-auto">
                    <div class="mb-10">
                        <h1 class="text-3xl font-bold text-gray-900 mb-3">Complete Your Onboarding</h1>
                        <p class="text-gray-600">Please fill out all the required information accurately</p>
                    </div>

                    <form id="onboardingForm" class="space-y-8" enctype="multipart/form-data">
                        {% csrf_token %}
                        <!-- Step 1: Personal Information -->
                        <div class="form-step active bg-white rounded-xl shadow-sm p-8" id="step1">
                            <h3 class="form-section-title">Personal Information</h3>
                            <div class="space-y-6">
                                <div class="relative">
                                    <label class="block text-sm font-medium text-gray-700">Full Name</label>
                                    <input type="text" id="name" name="name" value="{{ invitation.name }}" class="mt-1 block w-full" required>
                                </div>
                                <div class="relative">
                                    <label class="block text-sm font-medium text-gray-700">Email Address</label>
                                    <div class="relative">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <svg class="h-5 w-5 text-indigo-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                                            </svg>
                                        </div>
                                        <input type="email" id="email" name="email" value="{{ invitation.email }}" class="pl-10 mt-1 block w-full" readonly>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                                    <div class="relative">
                                        <label class="block text-sm font-medium text-gray-700">Date of Birth</label>
                                        <div class="relative">
                                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                                <svg class="h-5 w-5 text-indigo-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                                </svg>
                                            </div>
                                            <input type="date" id="dob" name="dob" class="pl-10 mt-1 block w-full" required>
                                        </div>
                                        <p class="mt-1 text-sm text-red-600 hidden" id="dob-error">You must be at least 18 years old</p>
                                    </div>
                                    <div class="relative">
                                        <label class="block text-sm font-medium text-gray-700">Gender</label>
                                        <select id="gender" name="gender" class="mt-1 block w-full" required>
                                            <option value="">Select Gender</option>
                                            <option value="male">Male</option>
                                            <option value="female">Female</option>
                                            <option value="other">Other</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="relative">
                                    <label class="block text-sm font-medium text-gray-700">Phone Number</label>
                                    <div class="flex">
                                        <span class="inline-flex items-center px-4 rounded-l-xl border border-r-0 border-gray-300 bg-gray-50 text-gray-600 text-sm font-medium">
                                            +91
                                        </span>
                                        <input type="tel" id="phone" name="phone" class="flex-1 rounded-l-none" pattern="[0-9]{10}" maxlength="10" required>
                                    </div>
                                    <p class="mt-1 text-sm text-gray-500">Enter 10 digit mobile number</p>
                                </div>
                                <div class="relative">
                                    <label class="block text-sm font-medium text-gray-700">Alternate Phone (Optional)</label>
                                    <div class="flex">
                                        <span class="inline-flex items-center px-4 rounded-l-xl border border-r-0 border-gray-300 bg-gray-50 text-gray-600 text-sm font-medium">
                                            +91
                                        </span>
                                        <input type="tel" id="altPhone" name="alt_phone" class="flex-1 rounded-l-none" pattern="[0-9]{10}" maxlength="10">
                                    </div>
                                </div>
                                <div class="relative">
                                    <label class="block text-sm font-medium text-gray-700">Current Address</label>
                                    <textarea id="address" name="address" rows="3" class="mt-1 block w-full" required></textarea>
                                </div>
                                <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                                    <div class="relative">
                                        <label class="block text-sm font-medium text-gray-700">City</label>
                                        <input type="text" id="city" name="city" class="mt-1 block w-full" required>
                                    </div>
                                    <div class="relative">
                                        <label class="block text-sm font-medium text-gray-700">State</label>
                                        <input type="text" id="state" name="state" class="mt-1 block w-full" required>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                                    <div class="relative">
                                        <label class="block text-sm font-medium text-gray-700">Pincode</label>
                                        <input type="text" id="pincode" name="pincode" pattern="[0-9]{6}" maxlength="6" class="mt-1 block w-full" required>
                                    </div>
                                    <div class="relative">
                                        <label class="block text-sm font-medium text-gray-700">Country</label>
                                        <input type="text" id="country" name="country" value="India" class="mt-1 block w-full" required>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Step 2: Employment Details -->
                        <div class="form-step bg-white rounded-xl shadow-sm p-8" id="step2">
                            <h3 class="form-section-title">Employment Details</h3>
                            <div class="space-y-6">
                                <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                                    <div class="relative">
                                        <label class="block text-sm font-medium text-gray-700">Department</label>
                                        <div class="relative">
                                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                                <svg class="h-5 w-5 text-indigo-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                                                </svg>
                                            </div>
                                            <input type="text" id="department" name="department" value="{{ invitation.department }}" class="pl-10 mt-1 block w-full" readonly>
                                        </div>
                                    </div>
                                    <div class="relative">
                                        <label class="block text-sm font-medium text-gray-700">Designation</label>
                                        <div class="relative">
                                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                                <svg class="h-5 w-5 text-indigo-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                                                </svg>
                                            </div>
                                            <input type="text" id="designation" name="designation" value="{{ invitation.designation }}" class="pl-10 mt-1 block w-full" readonly>
                                        </div>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                                    <div class="relative">
                                        <label class="block text-sm font-medium text-gray-700">Role</label>
                                        <div class="relative">
                                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                                <svg class="h-5 w-5 text-indigo-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V8a2 2 0 00-2-2h-5m-4 0V5a2 2 0 114 0v1m-4 0a2 2 0 104 0m-5 8a2 2 0 100-4 2 2 0 000 4zm0 0c1.306 0 2.417.835 2.83 2M9 14a3.001 3.001 0 00-2.83 2M15 11h3m-3 4h2" />
                                                </svg>
                                            </div>
                                            <input type="text" id="role" name="role" value="{{ invitation.role }}" class="pl-10 mt-1 block w-full" readonly>
                                        </div>
                                    </div>
                                    <div class="relative">
                                        <label class="block text-sm font-medium text-gray-700">Expected Start Date</label>
                                        <div class="relative">
                                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                                <svg class="h-5 w-5 text-indigo-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                                </svg>
                                            </div>
                                            <input type="date" id="startDate" name="start_date" class="pl-10 mt-1 block w-full" required>
                                        </div>
                                    </div>
                                </div>
                                <div class="relative">
                                    <label class="block text-sm font-medium text-gray-700">Current CTC (Annual, if applicable)</label>
                                    <div class="flex">
                                        <span class="inline-flex items-center px-4 rounded-l-xl border border-r-0 border-gray-300 bg-gray-50 text-gray-600 text-sm font-medium">
                                            ₹
                                        </span>
                                        <input type="text" id="currentCtc" name="current_ctc" class="flex-1 rounded-l-none" placeholder="e.g. 500000">
                                    </div>
                                </div>
                                <div class="relative">
                                    <label class="block text-sm font-medium text-gray-700">Expected CTC (Annual)</label>
                                    <div class="flex">
                                        <span class="inline-flex items-center px-4 rounded-l-xl border border-r-0 border-gray-300 bg-gray-50 text-gray-600 text-sm font-medium">
                                            ₹
                                        </span>
                                        <input type="text" id="expectedCtc" name="expected_ctc" class="flex-1 rounded-l-none" placeholder="e.g. 600000">
                                    </div>
                                </div>
                                <div class="relative">
                                    <label class="block text-sm font-medium text-gray-700">Skills & Expertise</label>
                                    <textarea id="skills" name="skills" rows="3" class="mt-1 block w-full" placeholder="List your key skills and areas of expertise"></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Step 3: Education & Experience -->
                        <div class="form-step bg-white rounded-xl shadow-sm p-8" id="step3">
                            <h3 class="form-section-title">Education & Experience</h3>
                            <div class="space-y-6">
                                <div class="relative">
                                    <label class="block text-sm font-medium text-gray-700">Highest Qualification</label>
                                    <select id="qualification" name="qualification" class="mt-1 block w-full" required>
                                        <option value="">Select Qualification</option>
                                        <option value="high_school">High School</option>
                                        <option value="diploma">Diploma</option>
                                        <option value="bachelors">Bachelor's Degree</option>
                                        <option value="masters">Master's Degree</option>
                                        <option value="phd">PhD</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                                <div class="relative">
                                    <label class="block text-sm font-medium text-gray-700">Institution/University</label>
                                    <div class="relative">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <svg class="h-5 w-5 text-indigo-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                                            </svg>
                                        </div>
                                        <input type="text" id="institution" name="institution" class="pl-10 mt-1 block w-full">
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                                    <div class="relative">
                                        <label class="block text-sm font-medium text-gray-700">Year of Passing</label>
                                        <input type="number" id="passingYear" name="passing_year" min="1980" max="2030" class="mt-1 block w-full">
                                    </div>
                                    <div class="relative">
                                        <label class="block text-sm font-medium text-gray-700">Percentage/CGPA</label>
                                        <input type="text" id="percentage" name="percentage" class="mt-1 block w-full">
                                    </div>
                                </div>
                                <div class="relative">
                                    <label class="block text-sm font-medium text-gray-700">Experience Level</label>
                                    <select id="experienceType" name="experience_type" class="mt-1 block w-full" required>
                                        <option value="fresher">Fresher</option>
                                        <option value="experienced">Experienced</option>
                                    </select>
                                </div>
                                <div id="experienceDetails" class="space-y-6 hidden bg-indigo-50 p-6 rounded-xl border border-indigo-100">
                                    <div class="relative">
                                        <label class="block text-sm font-medium text-gray-700">Years of Experience</label>
                                        <input type="number" id="yearsOfExperience" name="years_of_experience" min="1" max="50" class="mt-1 block w-full">
                                    </div>
                                    <div class="relative">
                                        <label class="block text-sm font-medium text-gray-700">Previous Company</label>
                                        <input type="text" id="previousCompany" name="previous_company" class="mt-1 block w-full">
                                    </div>
                                    <div class="relative">
                                        <label class="block text-sm font-medium text-gray-700">Previous Role</label>
                                        <input type="text" id="previousRole" name="previous_role" class="mt-1 block w-full">
                                    </div>
                                    <div class="relative">
                                        <label class="block text-sm font-medium text-gray-700">Reason for Leaving</label>
                                        <textarea id="reasonForLeaving" name="reason_for_leaving" rows="2" class="mt-1 block w-full"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Step 4: Emergency Contacts -->
                        <div class="form-step bg-white rounded-xl shadow-sm p-8" id="step4">
                            <h3 class="form-section-title">Emergency Contacts</h3>
                            <p class="text-sm text-gray-600 mb-6">Please provide contact details of people we should contact in case of an emergency.</p>
                            
                            <div class="space-y-8">
                                <!-- Emergency Contact 1 -->
                                <div class="border border-gray-200 p-6 rounded-xl shadow-sm bg-white">
                                    <h4 class="font-medium text-lg text-indigo-700 mb-4 flex items-center">
                                        <svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                        </svg>
                                        Primary Emergency Contact
                                    </h4>
                                    <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                                        <div class="relative">
                                            <label class="block text-sm font-medium text-gray-700">Full Name</label>
                                            <input type="text" name="emergency_contact1_name" class="mt-1 block w-full" required>
                                        </div>
                                        <div class="relative">
                                            <label class="block text-sm font-medium text-gray-700">Relationship</label>
                                            <input type="text" name="emergency_contact1_relationship" class="mt-1 block w-full" required>
                                        </div>
                                        <div class="relative">
                                            <label class="block text-sm font-medium text-gray-700">Phone Number</label>
                                            <div class="relative">
                                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                                    <svg class="h-5 w-5 text-indigo-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                                                    </svg>
                                                </div>
                                                <input type="tel" name="emergency_contact1_phone" pattern="[0-9]{10}" maxlength="10" class="pl-10 mt-1 block w-full" required>
                                            </div>
                                            <p class="mt-1 text-sm text-gray-500">10-digit mobile number</p>
                                        </div>
                                        <div class="relative">
                                            <label class="block text-sm font-medium text-gray-700">Email Address</label>
                                            <div class="relative">
                                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                                    <svg class="h-5 w-5 text-indigo-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                                                    </svg>
                                                </div>
                                                <input type="email" name="emergency_contact1_email" class="pl-10 mt-1 block w-full">
                                            </div>
                                        </div>
                                        <div class="relative sm:col-span-2">
                                            <label class="block text-sm font-medium text-gray-700">Address</label>
                                            <textarea name="emergency_contact1_address" rows="2" class="mt-1 block w-full"></textarea>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Emergency Contact 2 -->
                                <div class="border border-gray-200 p-6 rounded-xl shadow-sm bg-gray-50">
                                    <h4 class="font-medium text-lg text-indigo-700 mb-4 flex items-center">
                                        <svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                        </svg>
                                        Secondary Emergency Contact
                                    </h4>
                                    <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                                        <div class="relative">
                                            <label class="block text-sm font-medium text-gray-700">Full Name</label>
                                            <input type="text" name="emergency_contact2_name" class="mt-1 block w-full">
                                        </div>
                                        <div class="relative">
                                            <label class="block text-sm font-medium text-gray-700">Relationship</label>
                                            <input type="text" name="emergency_contact2_relationship" class="mt-1 block w-full">
                                        </div>
                                        <div class="relative">
                                            <label class="block text-sm font-medium text-gray-700">Phone Number</label>
                                            <div class="relative">
                                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                                    <svg class="h-5 w-5 text-indigo-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                                                    </svg>
                                                </div>
                                                <input type="tel" name="emergency_contact2_phone" pattern="[0-9]{10}" maxlength="10" class="pl-10 mt-1 block w-full">
                                            </div>
                                            <p class="mt-1 text-sm text-gray-500">10-digit mobile number</p>
                                        </div>
                                        <div class="relative">
                                            <label class="block text-sm font-medium text-gray-700">Email Address</label>
                                            <div class="relative">
                                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                                    <svg class="h-5 w-5 text-indigo-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                                                    </svg>
                                                </div>
                                                <input type="email" name="emergency_contact2_email" class="pl-10 mt-1 block w-full">
                                            </div>
                                        </div>
                                        <div class="relative sm:col-span-2">
                                            <label class="block text-sm font-medium text-gray-700">Address</label>
                                            <textarea name="emergency_contact2_address" rows="2" class="mt-1 block w-full"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Step 5: Document Upload -->
                        <div class="form-step bg-white rounded-xl shadow-sm p-8" id="step5">
                            <h3 class="form-section-title">Document Upload</h3>
                            <p class="text-sm text-gray-600 mb-6">Please upload clear, readable scans or photos of the following documents:</p>
                            
                            <div class="space-y-6">
                                <!-- Common documents for both fresher and experienced -->
                                <div class="border border-gray-200 p-6 rounded-xl shadow-sm bg-white hover:border-indigo-200 transition-colors duration-200">
                                    <div class="flex items-start gap-4">
                                        <div class="flex-shrink-0 bg-indigo-100 p-3 rounded-lg">
                                            <svg class="w-6 h-6 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                            </svg>
                                        </div>
                                        <div class="flex-1">
                                            <label class="block text-sm font-medium text-gray-700">Professional Photo <span class="text-red-500">*</span></label>
                                            <input type="file" name="profile_photo" accept="image/*" class="mt-2 block w-full" required>
                                            <p class="text-xs text-gray-500 mt-1">Upload a recent professional photo with clear face visibility and plain background</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Resume/CV -->
                                <div class="border border-gray-200 p-6 rounded-xl shadow-sm bg-white hover:border-indigo-200 transition-colors duration-200">
                                    <div class="flex items-start gap-4">
                                        <div class="flex-shrink-0 bg-indigo-100 p-3 rounded-lg">
                                            <svg class="w-6 h-6 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                            </svg>
                                        </div>
                                        <div class="flex-1">
                                            <label class="block text-sm font-medium text-gray-700">Resume/CV <span class="text-red-500">*</span></label>
                                            <input type="file" name="resume" accept=".pdf,.doc,.docx" class="mt-2 block w-full" required>
                                            <p class="text-xs text-gray-500 mt-1">Upload your latest resume (PDF or Word format preferred)</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- PAN Card -->
                                <div class="border border-gray-200 p-6 rounded-xl shadow-sm bg-white hover:border-indigo-200 transition-colors duration-200">
                                    <div class="flex items-start gap-4">
                                        <div class="flex-shrink-0 bg-indigo-100 p-3 rounded-lg">
                                            <svg class="w-6 h-6 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V8a2 2 0 00-2-2h-5m-4 0V5a2 2 0 114 0v1m-4 0a2 2 0 104 0m-5 8a2 2 0 100-4 2 2 0 000 4zm0 0c1.306 0 2.417.835 2.83 2M9 14a3.001 3.001 0 00-2.83 2M15 11h3m-3 4h2" />
                                            </svg>
                                        </div>
                                        <div class="flex-1">
                                            <label class="block text-sm font-medium text-gray-700">PAN Card <span class="text-red-500">*</span></label>
                                            <input type="file" name="pan_card" accept="image/*,.pdf" class="mt-2 block w-full" required>
                                            <p class="text-xs text-gray-500 mt-1">Upload a clear scan or photo of your PAN card</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Aadhaar Card -->
                                <div class="border border-gray-200 p-6 rounded-xl shadow-sm bg-white hover:border-indigo-200 transition-colors duration-200">
                                    <div class="flex items-start gap-4">
                                        <div class="flex-shrink-0 bg-indigo-100 p-3 rounded-lg">
                                            <svg class="w-6 h-6 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 9h3.75M15 12h3.75M15 15h3.75M4.5 19.5h15a2.25 2.25 0 002.25-2.25V6.75A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25v10.5A2.25 2.25 0 004.5 19.5zm6-10.125a1.875 1.875 0 11-3.75 0 1.875 1.875 0 013.75 0zm1.294 6.336a6.721 6.721 0 01-3.17.789 6.721 6.721 0 01-3.168-.789 3.376 3.376 0 016.338 0z" />
                                            </svg>
                                        </div>
                                        <div class="flex-1">
                                            <label class="block text-sm font-medium text-gray-700">Aadhaar Card <span class="text-red-500">*</span></label>
                                            <input type="file" name="aadhaar_card" accept="image/*,.pdf" class="mt-2 block w-full" required>
                                            <p class="text-xs text-gray-500 mt-1">Upload a clear scan or photo of both sides of your Aadhaar card</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Bank Statement -->
                                <div class="border border-gray-200 p-6 rounded-xl shadow-sm bg-white hover:border-indigo-200 transition-colors duration-200">
                                    <div class="flex items-start gap-4">
                                        <div class="flex-shrink-0 bg-indigo-100 p-3 rounded-lg">
                                            <svg class="w-6 h-6 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" />
                                            </svg>
                                        </div>
                                        <div class="flex-1">
                                            <label class="block text-sm font-medium text-gray-700">Bank Statement <span class="text-red-500">*</span></label>
                                            <input type="file" name="bank_statement" accept="image/*,.pdf" class="mt-2 block w-full" required>
                                            <p class="text-xs text-gray-500 mt-1">Upload your recent bank statement (last 3 months)</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Education Certificate -->
                                <div class="border border-gray-200 p-6 rounded-xl shadow-sm bg-white hover:border-indigo-200 transition-colors duration-200">
                                    <div class="flex items-start gap-4">
                                        <div class="flex-shrink-0 bg-indigo-100 p-3 rounded-lg">
                                            <svg class="w-6 h-6 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path d="M12 14l9-5-9-5-9 5 9 5z" />
                                                <path d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z" />
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l9-5-9-5-9 5 9 5zm0 0l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14zm-4 6v-7.5l4-2.222" />
                                            </svg>
                                        </div>
                                        <div class="flex-1">
                                            <label class="block text-sm font-medium text-gray-700">Highest Qualification Certificate <span class="text-red-500">*</span></label>
                                            <input type="file" name="education_certificate" accept="image/*,.pdf" class="mt-2 block w-full" required>
                                            <p class="text-xs text-gray-500 mt-1">Upload your highest qualification certificate</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Experience Documents (conditional) -->
                                <div id="experienceDocuments" class="hidden space-y-6">
                                    <!-- Salary Slip -->
                                    <div class="border border-gray-200 p-6 rounded-xl shadow-sm bg-white hover:border-indigo-200 transition-colors duration-200">
                                        <div class="flex items-start gap-4">
                                            <div class="flex-shrink-0 bg-indigo-100 p-3 rounded-lg">
                                                <svg class="w-6 h-6 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" />
                                                </svg>
                                            </div>
                                            <div class="flex-1">
                                                <label class="block text-sm font-medium text-gray-700">Salary Slips <span class="text-red-500">*</span></label>
                                                <input type="file" name="salary_slips" accept="image/*,.pdf" class="mt-2 block w-full" multiple required>
                                                <p class="text-xs text-gray-500 mt-1">Upload your last 3 month's salary slips</p>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Joining Letter -->
                                    <div class="border border-gray-200 p-6 rounded-xl shadow-sm bg-white hover:border-indigo-200 transition-colors duration-200">
                                        <div class="flex items-start gap-4">
                                            <div class="flex-shrink-0 bg-indigo-100 p-3 rounded-lg">
                                                <svg class="w-6 h-6 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                                </svg>
                                            </div>
                                            <div class="flex-1">
                                                <label class="block text-sm font-medium text-gray-700">Joining Letter <span class="text-red-500">*</span></label>
                                                <input type="file" name="joining_letter" accept="image/*,.pdf" class="mt-2 block w-full" required>
                                                <p class="text-xs text-gray-500 mt-1">Upload joining letter from your previous employer</p>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Offer Letter -->
                                    <div class="border border-gray-200 p-6 rounded-xl shadow-sm bg-white hover:border-indigo-200 transition-colors duration-200">
                                        <div class="flex items-start gap-4">
                                            <div class="flex-shrink-0 bg-indigo-100 p-3 rounded-lg">
                                                <svg class="w-6 h-6 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                                </svg>
                                            </div>
                                            <div class="flex-1">
                                                <label class="block text-sm font-medium text-gray-700">Offer Letter <span class="text-red-500">*</span></label>
                                                <input type="file" name="offer_letter" accept="image/*,.pdf" class="mt-2 block w-full" required>
                                                <p class="text-xs text-gray-500 mt-1">Upload offer letter from your previous employer</p>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Relieving Letter -->
                                    <div class="border border-gray-200 p-6 rounded-xl shadow-sm bg-white hover:border-indigo-200 transition-colors duration-200">
                                        <div class="flex items-start gap-4">
                                            <div class="flex-shrink-0 bg-indigo-100 p-3 rounded-lg">
                                                <svg class="w-6 h-6 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                                </svg>
                                            </div>
                                            <div class="flex-1">
                                                <label class="block text-sm font-medium text-gray-700">Relieving Letter <span class="text-red-500">*</span></label>
                                                <input type="file" name="relieving_letter" accept="image/*,.pdf" class="mt-2 block w-full" required>
                                                <p class="text-xs text-gray-500 mt-1">Upload relieving letter from your previous employer</p>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Experience Letter -->
                                    <div class="border border-gray-200 p-6 rounded-xl shadow-sm bg-white hover:border-indigo-200 transition-colors duration-200">
                                        <div class="flex items-start gap-4">
                                            <div class="flex-shrink-0 bg-indigo-100 p-3 rounded-lg">
                                                <svg class="w-6 h-6 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                                </svg>
                                            </div>
                                            <div class="flex-1">
                                                <label class="block text-sm font-medium text-gray-700">Experience Letter <span class="text-red-500">*</span></label>
                                                <input type="file" name="experience_letter" accept="image/*,.pdf" class="mt-2 block w-full" required>
                                                <p class="text-xs text-gray-500 mt-1">Upload experience letter from your previous employer</p>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Resignation Acceptance Letter -->
                                    <div class="border border-gray-200 p-6 rounded-xl shadow-sm bg-white hover:border-indigo-200 transition-colors duration-200">
                                        <div class="flex items-start gap-4">
                                            <div class="flex-shrink-0 bg-indigo-100 p-3 rounded-lg">
                                                <svg class="w-6 h-6 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                                </svg>
                                            </div>
                                            <div class="flex-1">
                                                <label class="block text-sm font-medium text-gray-700">Resignation Acceptance Letter <span class="text-red-500">*</span></label>
                                                <input type="file" name="resignation_letter" accept="image/*,.pdf" class="mt-2 block w-full" required>
                                                <p class="text-xs text-gray-500 mt-1">Upload resignation acceptance letter from your previous employer</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Step 6: Review & Submit -->
                        <div class="form-step bg-white rounded-xl shadow-sm p-8" id="step6">
                            <h3 class="form-section-title">Review Your Information</h3>
                            <p class="text-sm text-gray-600 mb-6">Please review all the information you've provided before final submission:</p>
                            
                            <div id="reviewContent" class="bg-gray-50 p-6 rounded-xl border border-gray-200 shadow-inner space-y-6">
                                <!-- This will be populated by JavaScript -->
                            </div>
                            
                            <div class="border-t border-gray-200 mt-8 pt-6">
                                <div class="flex items-start">
                                    <div class="flex items-center h-5">
                                        <input id="acceptTerms" name="accept_terms" type="checkbox" class="focus:ring-indigo-500 h-5 w-5 text-indigo-600 border-gray-300 rounded" required>
                                    </div>
                                    <div class="ml-3">
                                        <label for="acceptTerms" class="font-medium text-gray-700">I confirm that all information provided is accurate and complete</label>
                                        <p class="text-gray-500 text-sm mt-1">By submitting this form, I acknowledge that providing false information may result in termination of employment.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Success message (hidden initially) -->
                        <div id="successMessage" class="hidden text-center py-10">
                            <div class="bg-white rounded-xl shadow-sm p-10">
                                <div class="w-20 h-20 bg-green-100 text-green-500 rounded-full flex items-center justify-center mx-auto mb-6">
                                    <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                    </svg>
                                </div>
                                <h3 class="text-2xl font-bold text-gray-800 mb-3">Thank You!</h3>
                                <p class="text-gray-600 mb-6">Your onboarding form has been submitted successfully.</p>
                                <p class="text-gray-600">Our HR team will contact you shortly with next steps.</p>
                            </div>
                        </div>

                        <!-- Navigation Buttons -->
                        <div class="flex justify-between mt-10">
                            <button type="button" id="prevBtn" class="btn-secondary" style="display: none;">
                                <span class="inline-flex mr-2">
                                    <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                                    </svg>
                                </span>
                                Previous
                            </button>
                            <button type="button" id="nextBtn" class="border border-indigo-600 text-indigo-600 px-4 py-2 rounded-md ml-auto">
                                Next
                                <span class="inline-flex ml-2">
                                    <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                    </svg>
                                </span>
                            </button>
                            <button type="button" id="submitBtn" class="btn-primary ml-auto" style="display: none;">
                                <span class="inline-flex mr-2">
                                    <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                    </svg>
                                </span>
                                Submit Application
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- Rejection message (hidden initially) -->
        <div id="rejectionMessage" class="bg-white shadow-lg rounded-xl overflow-hidden hidden p-10 text-center max-w-2xl mx-auto">
            <div class="w-20 h-20 bg-gray-100 text-gray-500 rounded-full flex items-center justify-center mx-auto mb-6">
                <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                </svg>
            </div>
            <h3 class="text-2xl font-bold text-gray-800 mb-3">Invitation Declined</h3>
            <p class="text-gray-600 mb-6">You have declined the invitation from {{ invitation.company.company_name }}.</p>
            <p class="text-gray-600 mb-8">If this was a mistake, please contact the HR team to receive a new invitation.</p>
            <div>
                <button onclick="location.reload()" class="bg-indigo-100 hover:bg-indigo-200 text-indigo-700 font-medium py-3 px-8 rounded-xl transition duration-200 transform hover:scale-105">
                    Return to Invitation
                </button>
            </div>
        </div>
        
        <!-- Success message modal -->
        <div id="successModal" class="fixed inset-0 bg-black bg-opacity-60 backdrop-filter backdrop-blur-sm flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-xl p-8 max-w-md mx-4 w-full shadow-2xl">
                <div class="text-center">
                    <!-- Success Icon -->
                    <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-green-100 mb-6">
                        <svg class="h-8 w-8 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                        </svg>
                    </div>
                    
                    <h3 class="text-xl leading-6 font-bold text-gray-900 mb-3">Onboarding Successful!</h3>
                    <div class="mt-2">
                        <p class="text-gray-600">
                            Thank you for completing your onboarding with {{ invitation.company.company_name }}. Your information has been submitted successfully. Our HR team will contact you shortly with next steps.
                        </p>
                    </div>
                    
                    <div class="mt-8">
                        <button onclick="closeSuccessModal()" class="w-full rounded-xl border border-transparent shadow-sm px-6 py-4 bg-gradient-to-r from-indigo-600 to-purple-600 text-base font-medium text-white hover:from-indigo-700 hover:to-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transform transition duration-200 hover:scale-105">
                            Close
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer note -->
        <div class="mt-8 text-center text-gray-500 text-sm">
            <p>If you have any questions, please contact our HR department at <a href="mailto:hr@{{ invitation.company.company_email }}" class="text-indigo-600 hover:underline">hr@{{ invitation.company.company_email }}</a></p>
        </div>
    </div>
    
    <script>
        // Global variables for step management
        let currentStep = 1;
        const totalSteps = 6;
        
        // Show welcome modal on page load only if not previously closed
        document.addEventListener('DOMContentLoaded', function() {
            // Set up event listeners
            setupEventListeners();
            
            // Check if the welcome modal was previously closed
            if (!localStorage.getItem('onboardingWelcomeModalClosed')) {
                document.getElementById('welcomeModal').classList.remove('hidden');
            } else {
                document.getElementById('onboardingFormContainer').classList.remove('hidden');
                
                // Wait for a brief moment to ensure the form is fully rendered
                // before attempting to load saved data
                setTimeout(() => {
                    try {
                        loadFormData(); // Load saved form data
                        updateStepIndicators(1);
                    } catch (err) {
                        console.error('Error during form initialization:', err);
                    }
                }, 100);
            }
        });

        // Close welcome modal, save state, and show the form
        function closeWelcomeModal() {
            document.getElementById('welcomeModal').classList.add('hidden');
            document.getElementById('onboardingFormContainer').classList.remove('hidden');
            // Save in localStorage that the welcome modal has been closed
            localStorage.setItem('onboardingWelcomeModalClosed', 'true');
            updateStepIndicators(1);
        }

        // Close success modal
        function closeSuccessModal() {
            document.getElementById('successModal').classList.add('hidden');
            // Clear form data from localStorage after successful submission
            clearFormData();
            window.location.href = '/'; // Redirect to home page
        }

        // Save form data to localStorage
        function saveFormData() {
            try {
                const form = document.getElementById('onboardingForm');
                if (!form) return; // Exit if form is not found
                
                const formData = new FormData(form);
                const formDataObj = {};
                
                // Save text inputs, selects, and textareas
                formData.forEach((value, key) => {
                    // Skip file inputs
                    if (!key.includes('file') && value !== '') {
                        formDataObj[key] = value;
                    }
                });
                
                // Save checkboxes
                try {
                    form.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                        if (checkbox && checkbox.name) {
                            formDataObj[checkbox.name] = checkbox.checked;
                        }
                    });
                } catch (err) {
                    console.warn('Error saving checkbox values:', err);
                }
                
                // Store experience type specifically to handle conditional fields
                try {
                    const experienceType = document.getElementById('experienceType');
                    if (experienceType && experienceType.value) {
                        formDataObj['experience_type'] = experienceType.value;
                    }
                } catch (err) {
                    console.warn('Error saving experience type:', err);
                }
                
                localStorage.setItem('onboardingFormData', JSON.stringify(formDataObj));
            } catch (err) {
                console.error('Error saving form data to localStorage:', err);
            }
        }
        
        // Load form data from localStorage
        function loadFormData() {
            try {
                const savedData = localStorage.getItem('onboardingFormData');
                if (!savedData) return;
                
                const formDataObj = JSON.parse(savedData);
                const form = document.getElementById('onboardingForm');
                if (!form) return; // Exit if form is not found
                
                // Safely populate text inputs, selects, and textareas
                Object.keys(formDataObj).forEach(key => {
                    try {
                        const element = form.elements[key];
                        if (element && element.nodeType) {
                            if (element.type === 'checkbox') {
                                element.checked = formDataObj[key];
                            } else {
                                element.value = formDataObj[key];
                            }
                        }
                    } catch (err) {
                        console.warn(`Could not set value for field: ${key}`, err);
                    }
                });
                
                // Safely handle experience type change to show/hide conditional fields
                try {
                    if (formDataObj['experience_type'] === 'experienced') {
                        const experienceDetails = document.getElementById('experienceDetails');
                        const experienceDocuments = document.getElementById('experienceDocuments');
                        
                        if (experienceDetails && experienceDetails.classList) {
                            experienceDetails.classList.remove('hidden');
                        }
                        
                        if (experienceDocuments && experienceDocuments.classList) {
                            experienceDocuments.classList.remove('hidden');
                        }
                    }
                } catch (err) {
                    console.warn('Could not update experience fields visibility', err);
                }
            } catch (err) {
                console.error('Error loading form data from localStorage:', err);
                // Clear potentially corrupted data
                localStorage.removeItem('onboardingFormData');
            }
        }
        
        // Clear form data from localStorage
        function clearFormData() {
            localStorage.removeItem('onboardingFormData');
            localStorage.removeItem('onboardingWelcomeModalClosed');
        }

        function setupEventListeners() {
            // Experience type change handler
            const experienceTypeSelect = document.getElementById('experienceType');
            if (experienceTypeSelect) {
                experienceTypeSelect.addEventListener('change', function() {
                    const experienceDetails = document.getElementById('experienceDetails');
                    const experienceDocuments = document.getElementById('experienceDocuments');
                    
                    if (this.value === 'experienced') {
                        experienceDetails.classList.remove('hidden');
                        if (experienceDocuments) {
                            experienceDocuments.classList.remove('hidden');
                        }
                    } else {
                        experienceDetails.classList.add('hidden');
                        if (experienceDocuments) {
                            experienceDocuments.classList.add('hidden');
                        }
                    }
                    
                    // Save form data on change
                    saveFormData();
                });
            }
            
            // Add input event listeners to save form data
            const form = document.getElementById('onboardingForm');
            if (form) {
                const inputs = form.querySelectorAll('input, select, textarea');
                inputs.forEach(input => {
                    input.addEventListener('change', function() {
                        saveFormData();
                    });
                    
                    // For text inputs, also save on input event (as user types)
                    if (input.type === 'text' || input.type === 'email' || input.type === 'tel' || input.tagName === 'TEXTAREA') {
                        input.addEventListener('input', function() {
                            saveFormData();
                        });
                    }
                });
            }
            
            // Date of birth validation
            const dobInput = document.getElementById('dob');
            if (dobInput) {
                dobInput.addEventListener('change', function() {
                    validateAge(this);
                });
            }
            
            // Terms acceptance checkbox
            const termsCheckbox = document.getElementById('acceptTerms');
            const submitBtn = document.getElementById('submitBtn');
            if (termsCheckbox && submitBtn) {
                termsCheckbox.addEventListener('change', function() {
                    submitBtn.disabled = !this.checked;
                    
                    if (this.checked) {
                        submitBtn.classList.remove('bg-gray-400', 'cursor-not-allowed');
                        submitBtn.classList.add('bg-indigo-600', 'hover:bg-indigo-700');
                    } else {
                        submitBtn.classList.add('bg-gray-400', 'cursor-not-allowed');
                        submitBtn.classList.remove('bg-indigo-600', 'hover:bg-indigo-700');
                    }
                    
                    saveFormData();
                });
            }
            
            // Next button handler
            const nextBtn = document.getElementById('nextBtn');
            if (nextBtn) {
                nextBtn.addEventListener('click', function() {
                    goToNextStep();
                });
            }
            
            // Previous button handler
            const prevBtn = document.getElementById('prevBtn');
            if (prevBtn) {
                prevBtn.addEventListener('click', function() {
                    goToPrevStep();
                });
            }
            
            // Submit button handler
            if (submitBtn) {
                submitBtn.addEventListener('click', function(event) {
                    event.preventDefault();
                    if (validateStep(currentStep)) {
                        submitForm();
                    }
                });
            }
            
            // Step indicator clicks
            const stepIndicators = document.querySelectorAll('.step-indicator');
            stepIndicators.forEach(indicator => {
                indicator.addEventListener('click', function() {
                    const step = parseInt(this.getAttribute('data-step'));
                    if (validateAllPreviousSteps(step)) {
                        goToStep(step);
                    }
                });
            });
        }

        function validateAge(dobInput) {
            const dob = new Date(dobInput.value);
            const today = new Date();
            const age = today.getFullYear() - dob.getFullYear();
            const errorElement = document.getElementById('dob-error');
            
            // Check if at least 18 years old
            if (age < 18) {
                errorElement.classList.remove('hidden');
                dobInput.classList.add('error');
                return false;
            } else {
                errorElement.classList.add('hidden');
                dobInput.classList.remove('error');
                dobInput.classList.add('success');
                return true;
            }
        }

        function validateStep(step) {
            const currentStepElement = document.getElementById(`step${step}`);
            if (!currentStepElement) return true;
            
            // Get all required inputs in current step
            const requiredInputs = currentStepElement.querySelectorAll('input[required], select[required], textarea[required]');
            let isValid = true;
            
            // Clear any previous error messages
            const errorMessages = currentStepElement.querySelectorAll('.error-message');
            errorMessages.forEach(msg => msg.remove());
            
            // Validate each required field
            requiredInputs.forEach(input => {
                // Remove previous validation classes
                input.classList.remove('error', 'success');
                
                // Skip validation for hidden elements (like in conditional sections)
                if (isElementHidden(input)) {
                    return;
                }
                
                // Check if field is empty
                if (!input.value.trim()) {
                    input.classList.add('error');
                    addErrorMessage(input, 'This field is required');
                    isValid = false;
                } else {
                    // Additional validation based on input type
                    if (input.type === 'email') {
                        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                        if (!emailRegex.test(input.value.trim())) {
                            input.classList.add('error');
                            addErrorMessage(input, 'Please enter a valid email address');
                            isValid = false;
                        } else {
                            input.classList.add('success');
                        }
                    } 
                    else if (input.type === 'tel') {
                        const phoneRegex = /^[0-9]{10}$/;
                        if (!phoneRegex.test(input.value.trim())) {
                            input.classList.add('error');
                            addErrorMessage(input, 'Please enter a valid 10-digit phone number');
                            isValid = false;
                        } else {
                            input.classList.add('success');
                        }
                    }
                    else if (input.type === 'date') {
                        // Special validation for date of birth
                        if (input.id === 'dob' && !validateAge(input)) {
                            isValid = false;
                        } else {
                            input.classList.add('success');
                        }
                    }
                    else if (input.id === 'pincode') {
                        const pincodeRegex = /^[0-9]{6}$/;
                        if (!pincodeRegex.test(input.value.trim())) {
                            input.classList.add('error');
                            addErrorMessage(input, 'Please enter a valid 6-digit pincode');
                            isValid = false;
                        } else {
                            input.classList.add('success');
                        }
                    }
                    else if (input.type === 'file') {
                        if (input.files.length === 0) {
                            input.classList.add('error');
                            addErrorMessage(input, 'Please upload the required document');
                            isValid = false;
                        } else {
                            input.classList.add('success');
                        }
                    }
                    else {
                        // Mark as success if valid
                        input.classList.add('success');
                    }
                }
            });
            
            // Step-specific validations
            if (step === 1) {
                // Personal Information validation
                // Additional validation can be added here
            } 
            else if (step === 2) {
                // Employment Details validation
                const startDate = document.getElementById('startDate');
                if (startDate && startDate.value) {
                    const today = new Date();
                    const selectedDate = new Date(startDate.value);
                    if (selectedDate < today) {
                        startDate.classList.add('error');
                        startDate.classList.remove('success');
                        addErrorMessage(startDate, 'Start date should be today or in the future');
                        isValid = false;
                    }
                }
            }
            else if (step === 4) {
                // Emergency Contacts validation
                const primaryPhone = document.querySelector('input[name="emergency_contact1_phone"]');
                if (primaryPhone && primaryPhone.value) {
                    const phoneRegex = /^[0-9]{10}$/;
                    if (!phoneRegex.test(primaryPhone.value.trim())) {
                        primaryPhone.classList.add('error');
                        primaryPhone.classList.remove('success');
                        addErrorMessage(primaryPhone, 'Please enter a valid 10-digit phone number');
                        isValid = false;
                    }
                }
                
                const secondaryPhone = document.querySelector('input[name="emergency_contact2_phone"]');
                if (secondaryPhone && secondaryPhone.value) {
                    const phoneRegex = /^[0-9]{10}$/;
                    if (!phoneRegex.test(secondaryPhone.value.trim())) {
                        secondaryPhone.classList.add('error');
                        secondaryPhone.classList.remove('success');
                        addErrorMessage(secondaryPhone, 'Please enter a valid 10-digit phone number');
                        isValid = false;
                    }
                }
            }
            else if (step === 5) {
                // Document Upload validation
                // Validate based on experience type
                const experienceType = document.getElementById('experienceType').value;
                const experienceDocuments = document.getElementById('experienceDocuments');
                
                if (experienceType === 'experienced' && !experienceDocuments.classList.contains('hidden')) {
                    const experienceInputs = experienceDocuments.querySelectorAll('input[type="file"][required]');
                    experienceInputs.forEach(input => {
                        if (input.files.length === 0) {
                            input.classList.add('error');
                            input.classList.remove('success');
                            addErrorMessage(input, 'Please upload the required document');
                            isValid = false;
                        }
                    });
                }
            }
            
            if (!isValid) {
                // Show error message at the top of the form
                const errorDiv = document.createElement('div');
                errorDiv.className = 'bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-4 rounded-md error-message';
                errorDiv.innerHTML = '<p>Please fix the errors before proceeding.</p>';
                currentStepElement.prepend(errorDiv);
                
                // Scroll to the first error
                const firstError = currentStepElement.querySelector('.error');
                if (firstError) {
                    firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    firstError.focus();
                }
            }
            
            return isValid;
        }
        
        // Helper function to check if an element is hidden
        function isElementHidden(el) {
            // Check if the element itself is hidden
            if (el.style.display === 'none' || el.style.visibility === 'hidden') {
                return true;
            }
            
            // Check if any parent element is hidden
            let parent = el.parentElement;
            while (parent) {
                if (parent.classList.contains('hidden') || 
                    parent.style.display === 'none' || 
                    parent.style.visibility === 'hidden') {
                    return true;
                }
                parent = parent.parentElement;
            }
            
            return false;
        }
        
        // Helper function to add error messages below inputs
        function addErrorMessage(input, message) {
            const errorSpan = document.createElement('span');
            errorSpan.className = 'error-message';
            errorSpan.textContent = message;
            
            // Find the parent element (usually a div that contains the label and input)
            const parentElement = input.closest('.relative') || input.parentElement;
            parentElement.appendChild(errorSpan);
        }

        function validateAllPreviousSteps(targetStep) {
            for (let i = 1; i < targetStep; i++) {
                if (!validateStep(i)) {
                    goToStep(i);
                    return false;
                }
            }
            return true;
        }

        function goToStep(step) {
            // Hide all steps
            const allSteps = document.querySelectorAll('.form-step');
            allSteps.forEach(stepElement => {
                stepElement.classList.add('hidden');
                stepElement.classList.remove('active');
            });
            
            // Show target step
            const targetStep = document.getElementById(`step${step}`);
            if (targetStep) {
                targetStep.classList.remove('hidden');
                targetStep.classList.add('active');
                currentStep = step;
                updateStepIndicators(step);
                updateNavigationButtons();
                
                // If it's the review step, populate review content
                if (step === 6) {
                    populateReviewContent();
                }
                
                // Scroll to top of form
                targetStep.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        function goToNextStep() {
            if (validateStep(currentStep)) {
                if (currentStep < totalSteps) {
                    goToStep(currentStep + 1);
                }
            }
        }

        function goToPrevStep() {
            if (currentStep > 1) {
                goToStep(currentStep - 1);
            }
        }

        function updateStepIndicators(step) {
            const indicators = document.querySelectorAll('.step-indicator');
            
            indicators.forEach(indicator => {
                const indicatorStep = parseInt(indicator.getAttribute('data-step'));
                
                // Reset all indicators to default state
                indicator.classList.remove('active', 'completed', 'text-gray-900', 'text-gray-600', 'text-green-600');
                
                // Update the indicator based on the current step
                if (indicatorStep === step) {
                    // Current step
                    indicator.classList.add('active', 'text-gray-900');
                    
                    // Update the indicator with a circle
                    updateIndicatorIcon(indicator, 'current');
                } else if (indicatorStep < step) {
                    // Completed step
                    indicator.classList.add('completed', 'text-green-600');
                    
                    // Update the indicator with a checkmark
                    updateIndicatorIcon(indicator, 'completed');
                } else {
                    // Upcoming step
                    indicator.classList.add('text-gray-600');
                    
                    // Update the indicator with a circle
                    updateIndicatorIcon(indicator, 'upcoming');
                }
            });
        }
        
        // Helper function to update step indicator icons
        function updateIndicatorIcon(indicator, state) {
            // If the indicator already has a pseudo-element, we'll just modify the styles through CSS classes
            // This function can be expanded to add actual icons if needed
            
            // Get the step number
            const stepNumber = indicator.getAttribute('data-step');
            
            // Remove existing icon if any
            const existingIcon = indicator.querySelector('.step-icon');
            if (existingIcon) {
                existingIcon.remove();
            }
            
            // Create a new icon
            const icon = document.createElement('span');
            icon.className = 'step-icon absolute left-0 top-1/2 transform -translate-y-1/2 w-6 h-6 rounded-full flex items-center justify-center';
            
            switch (state) {
                case 'completed':
                    icon.classList.add('bg-green-500', 'text-white');
                    icon.innerHTML = '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>';
                    break;
                case 'current':
                    icon.classList.add('bg-blue-600', 'text-white');
                    icon.innerHTML = stepNumber;
                    break;
                case 'upcoming':
                    icon.classList.add('bg-gray-300', 'text-gray-600');
                    icon.innerHTML = stepNumber;
                    break;
            }
            
            // Add the icon to the indicator
            indicator.prepend(icon);
        }

        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const submitBtn = document.getElementById('submitBtn');
            
            // Show/hide previous button
            if (currentStep > 1) {
                prevBtn.style.display = 'block';
            } else {
                prevBtn.style.display = 'none';
            }
            
            // Show/hide next and submit buttons
            if (currentStep === totalSteps) {
                nextBtn.style.display = 'none';
                submitBtn.style.display = 'block';
                
                // Only enable submit button if terms are accepted
                const termsCheckbox = document.getElementById('acceptTerms');
                if (termsCheckbox) {
                    submitBtn.disabled = !termsCheckbox.checked;
                    
                    if (termsCheckbox.checked) {
                        submitBtn.classList.remove('bg-gray-400', 'cursor-not-allowed');
                        submitBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
                    } else {
                        submitBtn.classList.add('bg-gray-400', 'cursor-not-allowed');
                        submitBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                    }
                }
            } else {
                nextBtn.style.display = 'block';
                submitBtn.style.display = 'none';
                
                // Enable next button only if current step is valid
                nextBtn.disabled = false;
                nextBtn.classList.remove('bg-gray-400', 'cursor-not-allowed');
                nextBtn.classList.add('bg-blue-100', 'hover:bg-blue-100');
            }
            
            // Update step indicators
            updateStepIndicators(currentStep);
        }

        function populateReviewContent() {
            const reviewContent = document.getElementById('reviewContent');
            if (!reviewContent) return;
            
            // Personal information
            const personalInfo = `
                <div>
                    <h4 class="font-medium text-gray-700 mb-2">Personal Information</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                        <div><span class="font-medium">Name:</span> ${getValue('name')}</div>
                        <div><span class="font-medium">Email:</span> ${getValue('email')}</div>
                        <div><span class="font-medium">Phone:</span> ${getValue('phone')}</div>
                        <div><span class="font-medium">Alternate Phone:</span> ${getValue('altPhone') || 'Not specified'}</div>
                        <div><span class="font-medium">Date of Birth:</span> ${formatDate(getValue('dob'))}</div>
                        <div><span class="font-medium">Gender:</span> ${getValue('gender')}</div>
                        <div class="md:col-span-2"><span class="font-medium">Address:</span> ${getValue('address')}, ${getValue('city')}, ${getValue('state')}, ${getValue('pincode')}, ${getValue('country')}</div>
                    </div>
                </div>
            `;
            
            // Employment details
            const employmentInfo = `
                <div>
                    <h4 class="font-medium text-gray-700 mb-2">Employment Details</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                        <div><span class="font-medium">Department:</span> ${getValue('department')}</div>
                        <div><span class="font-medium">Designation:</span> ${getValue('designation')}</div>
                        <div><span class="font-medium">Role:</span> ${getValue('role')}</div>
                        <div><span class="font-medium">Expected Start Date:</span> ${formatDate(getValue('startDate'))}</div>
                        <div><span class="font-medium">Current CTC:</span> ₹${getValue('currentCtc') || 'Not specified'}</div>
                        <div><span class="font-medium">Expected CTC:</span> ₹${getValue('expectedCtc') || 'Not specified'}</div>
                        <div class="md:col-span-2"><span class="font-medium">Skills:</span> ${getValue('skills') || 'Not specified'}</div>
                    </div>
                </div>
            `;
            
            // Education and experience
            const educationInfo = `
                <div>
                    <h4 class="font-medium text-gray-700 mb-2">Education & Experience</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                        <div><span class="font-medium">Qualification:</span> ${getValue('qualification')}</div>
                        <div><span class="font-medium">Institution:</span> ${getValue('institution')}</div>
                        <div><span class="font-medium">Year of Passing:</span> ${getValue('passingYear')}</div>
                        <div><span class="font-medium">Percentage/CGPA:</span> ${getValue('percentage')}</div>
                        <div><span class="font-medium">Experience Type:</span> ${getValue('experienceType')}</div>
                    </div>
                    ${getValue('experienceType') === 'experienced' ? `
                        <div class="mt-2 text-sm">
                            <div><span class="font-medium">Years of Experience:</span> ${getValue('yearsOfExperience')}</div>
                            <div><span class="font-medium">Previous Company:</span> ${getValue('previousCompany')}</div>
                            <div><span class="font-medium">Previous Role:</span> ${getValue('previousRole')}</div>
                            <div><span class="font-medium">Reason for Leaving:</span> ${getValue('reasonForLeaving')}</div>
                        </div>
                    ` : ''}
                </div>
            `;
            
            // Emergency contacts
            const emergencyInfo = `
                <div>
                    <h4 class="font-medium text-gray-700 mb-2">Emergency Contacts</h4>
                    <div class="mb-3">
                        <h5 class="font-medium text-sm">Primary Contact</h5>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm ml-3">
                            <div><span class="font-medium">Name:</span> ${getValue('emergencyContact1Name')}</div>
                            <div><span class="font-medium">Relationship:</span> ${getValue('emergencyContact1Relationship')}</div>
                            <div><span class="font-medium">Phone:</span> ${getValue('emergencyContact1Phone')}</div>
                            <div><span class="font-medium">Email:</span> ${getValue('emergencyContact1Email') || 'Not specified'}</div>
                        </div>
                    </div>
                    ${getValue('emergencyContact2Name') ? `
                        <div>
                            <h5 class="font-medium text-sm">Secondary Contact</h5>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm ml-3">
                                <div><span class="font-medium">Name:</span> ${getValue('emergencyContact2Name')}</div>
                                <div><span class="font-medium">Relationship:</span> ${getValue('emergencyContact2Relationship')}</div>
                                <div><span class="font-medium">Phone:</span> ${getValue('emergencyContact2Phone')}</div>
                                <div><span class="font-medium">Email:</span> ${getValue('emergencyContact2Email') || 'Not specified'}</div>
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
            
            // Document uploads
            const documentInfo = `
                <div>
                    <h4 class="font-medium text-gray-700 mb-2">Uploaded Documents</h4>
                    <ul class="list-disc ml-5 text-sm">
                        ${document.querySelector('input[name="profile_photo"]').files.length ? '<li>Professional Photo</li>' : ''}
                        ${document.querySelector('input[name="resume"]').files.length ? '<li>Resume/CV</li>' : ''}
                        ${document.querySelector('input[name="id_proof"]').files.length ? '<li>ID Proof</li>' : ''}
                        ${document.querySelector('input[name="address_proof"]').files.length ? '<li>Address Proof</li>' : ''}
                        ${document.querySelector('input[name="education_certificate"]').files.length ? '<li>Education Certificate</li>' : ''}
                        ${getValue('experienceType') === 'experienced' ? `
                            ${document.querySelector('input[name="experience_certificate"]')?.files.length ? '<li>Experience Certificate(s)</li>' : ''}
                            ${document.querySelector('input[name="pay_slips"]')?.files.length ? '<li>Pay Slips</li>' : ''}
                        ` : ''}
                    </ul>
                </div>
            `;
            
            // Combine all sections
            reviewContent.innerHTML = `
                ${personalInfo}
                <hr class="my-4 border-gray-200">
                ${employmentInfo}
                <hr class="my-4 border-gray-200">
                ${educationInfo}
                <hr class="my-4 border-gray-200">
                ${emergencyInfo}
                <hr class="my-4 border-gray-200">
                ${documentInfo}
            `;
        }

        // Helper function to get form field values
        function getValue(id) {
            const element = document.getElementById(id) || document.querySelector(`[name="${id}"]`);
            if (!element) return '';
            
            if (element.tagName === 'SELECT') {
                const selectedOption = element.options[element.selectedIndex];
                return selectedOption ? selectedOption.text : '';
            }
            
            return element.value || '';
        }

        // Helper function to format dates
        function formatDate(dateString) {
            if (!dateString) return 'Not specified';
            
            const date = new Date(dateString);
            if (isNaN(date.getTime())) return dateString;
            
            return date.toLocaleDateString('en-IN', {
                day: '2-digit',
                month: 'short',
                year: 'numeric'
            });
        }

        // Submit form function
        function submitForm() {
            // Show loading state
            const submitBtn = document.getElementById('submitBtn');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white inline-block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Submitting...';
            submitBtn.disabled = true;
            
            // Validate all steps before submission
            for (let i = 1; i <= totalSteps; i++) {
                if (!validateStep(i)) {
                    goToStep(i);
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                    return;
                }
            }
            
            // Prepare form data with structured information
            const form = document.getElementById('onboardingForm');
            const formData = prepareFormDataForSubmission(form);
            
            // Get the current URL path which contains the token
            const currentPath = window.location.pathname;
            // Extract token from URL path
            const token = currentPath.split('/').filter(segment => segment).pop();
            
            // Submit form data to correct endpoint using the token
            fetch(`/hr_management/onboarding/form/${token}/`, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': getCsrfToken()
                }
            })
            .then(response => {
                if (!response.ok) {
                    return response.json().then(data => {
                        throw new Error(data.message || `Server error: ${response.status} ${response.statusText}`);
                    }).catch(() => {
                        // If JSON parsing fails, throw a generic error with the status
                        throw new Error(`Server error: ${response.status} ${response.statusText}`);
                    });
                }
                return response.json();
            })
            .then(data => {
                // Hide the form
                document.getElementById('onboardingFormContainer').classList.add('hidden');
                
                // Show success message
                document.getElementById('successModal').classList.remove('hidden');
                
                // Clear saved form data
                clearFormData();
                
                console.log('Form submitted successfully:', data);
            })
            .catch(error => {
                console.error('Error:', error);
                // Show error message
                const errorDiv = document.createElement('div');
                errorDiv.className = 'bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-4 rounded-md error-message';
                errorDiv.innerHTML = `<p>${error.message || 'An error occurred while submitting the form. Please try again.'}</p>`;
                form.prepend(errorDiv);
                
                // Reset button state
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
                
                // Scroll to error message
                errorDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
            });
        }

        // Function to prepare form data with all fields
        function prepareFormDataForSubmission(form) {
            const formData = new FormData(form);
            
            // Add form submission timestamp
            formData.append('submission_timestamp', new Date().toISOString());
            
            // Add status field
            formData.append('status', 'completed');
            
            // Add metadata for database categorization
            formData.append('form_version', '1.0');
            formData.append('source', 'web_onboarding');
            
            // Get all form fields and ensure they're included in formData
            const allFormElements = form.querySelectorAll('input, select, textarea');
            allFormElements.forEach(element => {
                if (element.name && element.value) {
                    // For files, FormData will automatically include them
                    if (element.type !== 'file') {
                        // Skip if already in formData (don't override file inputs)
                        if (!formData.has(element.name)) {
                            formData.append(element.name, element.value);
                        }
                    }
                }
            });
            
            // Add JSON serialized objects for better structure
            
            // Add employee personal info
            const personalInfo = {
                full_name: document.getElementById('name')?.value || '',
                email: document.getElementById('email')?.value || '',
                date_of_birth: document.getElementById('dob')?.value || '',
                gender: document.getElementById('gender')?.value || '',
                phone_number: document.getElementById('phone')?.value || '',
                alternate_phone: document.getElementById('altPhone')?.value || '',
                address: document.getElementById('address')?.value || '',
                city: document.getElementById('city')?.value || '',
                state: document.getElementById('state')?.value || '',
                pincode: document.getElementById('pincode')?.value || '',
                country: document.getElementById('country')?.value || ''
            };
            
            // Add employment details
            const employmentDetails = {
                department: document.getElementById('department')?.value || '',
                designation: document.getElementById('designation')?.value || '',
                role: document.getElementById('role')?.value || '',
                expected_start_date: document.getElementById('startDate')?.value || '',
                current_ctc: document.getElementById('currentCtc')?.value || '',
                expected_ctc: document.getElementById('expectedCtc')?.value || '',
                skills: document.getElementById('skills')?.value || ''
            };
            
            // Convert to JSON and append to formData
            formData.append('personal_info_json', JSON.stringify(personalInfo));
            formData.append('employment_details_json', JSON.stringify(employmentDetails));
            
            // Add a complete structured form_data object with all form values
            const completeFormData = {};
            allFormElements.forEach(element => {
                if (element.name && element.type !== 'file') {
                    completeFormData[element.name] = element.value;
                }
            });
            
            // Append the complete form data as JSON
            formData.append('complete_form_data_json', JSON.stringify(completeFormData));
            
            return formData;
        }

        // Add this code to submit the form and create credentials
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('onboardingForm');
            
            if (form) {
                form.addEventListener('submit', function(event) {
                    event.preventDefault();
                    submitForm();
                });
            }
        });
        
        // Helper function to get CSRF token
        function getCsrfToken() {
            // First try to get from form (most reliable)
            const csrfInput = document.querySelector('input[name="csrfmiddlewaretoken"]');
            if (csrfInput && csrfInput.value) {
                return csrfInput.value;
            }
            
            // Fallback to cookie
            const csrfCookie = document.cookie.split(';')
                .find(cookie => cookie.trim().startsWith('csrftoken='));
            
            if (csrfCookie) {
                return csrfCookie.split('=')[1];
            }
            
            return '';
        }
    </script>
</body>
</html>