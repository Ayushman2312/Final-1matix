{% extends 'user_dashboard/base.html' %}
{% load static %}

{% block content %}
<div class="max-w-4xl px-4">
    <!-- Header -->
    <div class="mb-6">
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-4 sm:space-y-0">
            <div>
                <h1 class="text-2xl font-bold text-gray-900">Edit Website Content</h1>
                <p class="mt-1 text-sm text-gray-600">Make changes to your website content. All changes are saved automatically.</p>
            </div>
            <div class="flex items-center space-x-3">
                <div id="auto-save-indicator" class="text-sm text-gray-500 hidden">
                    <span class="inline-flex items-center">
                        <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-blue-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <span id="auto-save-text">Saving...</span>
                    </span>
                </div>
                <a href="{% url 'preview_website' website.id %}" target="_blank" 
                   class="inline-flex items-center px-4 py-2 border border-blue-600 shadow-sm text-sm font-medium rounded-md text-blue-600 bg-white hover:bg-blue-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200">
                    <svg class="h-4 w-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                    </svg>
                    Preview Site
                </a>
            </div>
        </div>
    </div>

    <!-- Messages container -->
    <div id="messages-container" class="fixed top-4 right-4 z-50 w-96"></div>

    <form id="editWebsiteForm" method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        
        <!-- Contact Information Section -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <div class="flex items-start mb-4">
                <div class="flex-shrink-0 bg-blue-50 rounded-lg p-3">
                    <svg class="h-6 w-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                    </svg>
                </div>
                <div class="ml-4">
                    <h2 class="text-lg font-semibold text-gray-800">Contact Information</h2>
                    <p class="text-gray-600 text-sm">Add your business contact details for visitors to reach you</p>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Mobile Number -->
                <div>
                    <label for="mobile_number" class="block text-sm font-medium text-gray-700 mb-1">
                        Mobile Number
                    </label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                            </svg>
                        </div>
                        <input type="tel" id="mobile_number" name="mobile_number" 
                               value="{{ website.content.mobile_number|default:'' }}"
                               class="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white hover:border-gray-400 transition-colors" 
                               placeholder="+1 (555) 123-4567">
                    </div>
                    <p class="mt-1 text-sm text-gray-500">Include country code for international accessibility</p>
                </div>

                <!-- Email -->
                <div>
                    <label for="contact_email" class="block text-sm font-medium text-gray-700 mb-1">
                        Email Address
                    </label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"/>
                            </svg>
                        </div>
                        <input type="email" id="contact_email" name="contact_email" 
                               value="{{ website.content.contact_email|default:'' }}"
                               class="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white hover:border-gray-400 transition-colors" 
                               placeholder="contact@yourbusiness.com">
                    </div>
                    <p class="mt-1 text-sm text-gray-500">Business email where visitors can contact you</p>
                </div>

                <!-- Address -->
                <div class="md:col-span-2">
                    <label for="address" class="block text-sm font-medium text-gray-700 mb-1">
                        Business Address
                    </label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                            </svg>
                        </div>
                        <textarea id="address" name="address" rows="2"
                                  class="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white hover:border-gray-400 transition-colors resize-y"
                                  placeholder="123 Business Street, Suite 456, City, State, ZIP">{{ website.content.address|default:'' }}</textarea>
                    </div>
                    <p class="mt-1 text-sm text-gray-500">Full address of your business location</p>
                </div>

                <!-- Map Location -->
                <div class="md:col-span-2">
                    <label for="map_location" class="block text-sm font-medium text-gray-700 mb-1">
                        Map Location
                    </label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"/>
                            </svg>
                        </div>
                        <input type="url" id="map_location" name="map_location"
                               value="{{ website.content.map_location|default:'' }}"
                               class="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white hover:border-gray-400 transition-colors"
                               placeholder="https://www.google.com/maps/embed?...">
                    </div>
                    <div class="mt-1 text-sm text-gray-500">
                        <p>Paste your Google Maps embed URL here. To get this:</p>
                        <ol class="mt-1 ml-4 list-decimal text-xs space-y-1">
                            <li>Go to Google Maps and find your location</li>
                            <li>Click "Share" and select "Embed a map"</li>
                            <li>Copy the URL from the provided iframe's src attribute</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>

        <!-- Logo & Favicon Section -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <div class="flex items-start mb-4">
                <div class="flex-shrink-0 bg-blue-50 rounded-lg p-3">
                    <svg class="h-6 w-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                    </svg>
                </div>
                <div class="ml-4">
                    <h2 class="text-lg font-semibold text-gray-800">Logo & Favicon</h2>
                    <p class="text-gray-600 text-sm">Upload your brand logo and website favicon</p>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Desktop Logo -->
                <div>
                    <label for="desktop_logo" class="block text-sm font-medium text-gray-700 mb-1">
                        Desktop Logo
                    </label>
                    <div class="mt-1">
                        {% if website.content.desktop_logo %}
                        <div class="mb-2">
                            <img src="{{ website.content.desktop_logo }}" alt="Desktop Logo" class="max-h-24 rounded">
                            <div class="mt-2">
                                <label class="inline-flex items-center text-sm text-gray-600">
                                    <input type="checkbox" name="remove_desktop_logo" value="true" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                    <span class="ml-2">Remove desktop logo</span>
                                </label>
                            </div>
                        </div>
                        {% endif %}
                        <input type="file" name="desktop_logo" accept="image/*" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                        <p class="mt-1 text-sm text-gray-500">Upload your main website logo (PNG or SVG recommended)</p>
                    </div>
                </div>

                <!-- Mobile Logo -->
                <div>
                    <label for="mobile_logo" class="block text-sm font-medium text-gray-700 mb-1">
                        Mobile Logo
                    </label>
                    <div class="mt-1">
                        {% if website.content.mobile_logo %}
                        <div class="mb-2">
                            <img src="{{ website.content.mobile_logo }}" alt="Mobile Logo" class="max-h-24 rounded">
                            <div class="mt-2">
                                <label class="inline-flex items-center text-sm text-gray-600">
                                    <input type="checkbox" name="remove_mobile_logo" value="true" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                    <span class="ml-2">Remove mobile logo</span>
                                </label>
                            </div>
                        </div>
                        {% endif %}
                        <input type="file" name="mobile_logo" accept="image/*" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                        <p class="mt-1 text-sm text-gray-500">Smaller logo version for mobile devices</p>
                    </div>
                </div>

                <!-- Favicon -->
                <div class="md:col-span-2">
                    <label for="favicon" class="block text-sm font-medium text-gray-700 mb-1">
                        Favicon
                    </label>
                    <div class="mt-1">
                        {% if website.content.favicon %}
                        <div class="mb-2 flex items-center">
                            <img src="{{ website.content.favicon }}" alt="Favicon" class="h-8 w-8 rounded">
                            <div class="ml-4">
                                <label class="inline-flex items-center text-sm text-gray-600">
                                    <input type="checkbox" name="remove_favicon" value="true" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                    <span class="ml-2">Remove favicon</span>
                                </label>
                            </div>
                        </div>
                        {% endif %}
                        <input type="file" name="favicon" accept="image/*" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                        <p class="mt-1 text-sm text-gray-500">Small icon displayed in browser tabs (32x32px recommended)</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Legal Policies -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <div class="flex items-start mb-4">
                <div class="flex-shrink-0 bg-blue-50 rounded-lg p-3">
                    <svg class="h-6 w-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                    </svg>
                </div>
                <div class="ml-4">
                    <h2 class="text-lg font-semibold text-gray-800">Legal Policies</h2>
                    <p class="text-gray-600 text-sm">Add important legal policies for your website</p>
                </div>
            </div>

            <div class="space-y-6">
                <!-- Privacy Policy -->
                <div>
                    <label for="privacy_policy" class="block text-sm font-medium text-gray-700 mb-1">Privacy Policy</label>
                    <div class="relative">
                        <textarea id="privacy_policy" name="privacy_policy" rows="4" 
                            class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white hover:border-gray-400 transition-colors resize-y"
                            placeholder="Enter your privacy policy...">{{ website.content.privacy_policy|default:'' }}</textarea>
                    </div>
                    <p class="mt-1 text-sm text-gray-500">Explain how you collect, use, and protect personal information from your visitors.</p>
                </div>

                <!-- Terms and Conditions -->
                <div>
                    <label for="terms_conditions" class="block text-sm font-medium text-gray-700 mb-1">Terms & Conditions</label>
                    <div class="relative">
                        <textarea id="terms_conditions" name="terms_conditions" rows="4" 
                            class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white hover:border-gray-400 transition-colors resize-y"
                            placeholder="Enter your terms and conditions...">{{ website.content.terms_conditions|default:'' }}</textarea>
                    </div>
                    <p class="mt-1 text-sm text-gray-500">Set rules and guidelines for using your website and services.</p>
                </div>
            </div>
        </div>

        <!-- SEO Settings -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <div class="flex items-start mb-4">
                <div class="flex-shrink-0 bg-blue-50 rounded-lg p-3">
                    <svg class="h-6 w-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                    </svg>
                </div>
                <div class="ml-4">
                    <h2 class="text-lg font-semibold text-gray-800">SEO Settings</h2>
                    <p class="text-gray-600 text-sm">Optimize your website for search engines</p>
                </div>
            </div>

            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Meta Title</label>
                    <div class="relative">
                        <input type="text" name="meta_title" value="{{ website.content.meta_title|default:'' }}" 
                               class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white hover:border-gray-400 transition-colors" 
                               placeholder="e.g. Your Brand - Quality Products">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Meta Description</label>
                    <div class="relative">
                        <textarea name="meta_description" rows="2" 
                                  class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white hover:border-gray-400 transition-colors resize-y" 
                                  placeholder="Brief description of your website (max 160 characters)">{{ website.content.meta_description|default:'' }}</textarea>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Meta Keywords</label>
                    <div class="relative">
                        <input type="text" name="meta_keywords" value="{{ website.content.meta_keywords|default:'' }}" 
                               class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white hover:border-gray-400 transition-colors" 
                               placeholder="e.g. fashion, accessories, clothing">
                    </div>
                    <p class="mt-1 text-sm text-gray-500">Separate keywords with commas</p>
                </div>
            </div>
        </div>

        <!-- Document Library -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <div class="flex items-start mb-4">
                <div class="flex-shrink-0 bg-blue-50 rounded-lg p-3">
                    <svg class="h-6 w-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                    </svg>
                </div>
                <div class="ml-4">
                    <h2 class="text-lg font-semibold text-gray-800">Document Library</h2>
                    <p class="text-gray-600 text-sm">Upload and manage documents for your website</p>
                </div>
            </div>

            <div class="space-y-6">
                <div>
                    <label for="document" class="block text-sm font-medium text-gray-700 mb-1">Upload Document</label>
                    <div class="flex space-x-3">
                        <input type="file" id="document" name="document" 
                               class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                        <input type="text" id="document_name" name="document_name" 
                               class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white hover:border-gray-400 transition-colors"
                               placeholder="Document name (optional)">
                    </div>
                    <p class="mt-1 text-sm text-gray-500">Supported formats: PDF, Word, Excel, Text files</p>
                </div>
                
                <!-- Existing documents -->
                {% if website.content.documents %}
                <div class="mt-4">
                    <h3 class="text-sm font-medium text-gray-700 mb-3">Uploaded Documents</h3>
                    <div class="border border-gray-200 rounded-md divide-y divide-gray-200">
                        {% for doc in website.content.documents %}
                        <a href="{{ doc.path }}" class="block hover:bg-gray-50 p-4" target="_blank">
                            <div class="flex justify-between items-center">
                                <div class="flex items-center">
                                    <svg class="h-5 w-5 text-gray-400 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>
                                    </svg>
                                    <div>
                                        <p class="text-sm font-medium text-gray-900">{{ doc.name }}</p>
                                        <p class="text-xs text-gray-500">{{ doc.type }} - {{ doc.size|filesizeformat }}</p>
                                    </div>
                                </div>
                                <div class="text-xs text-gray-500">
                                    {{ doc.date_added|date:"M d, Y" }}
                                </div>
                            </div>
                        </a>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Gallery Images -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <div class="flex items-start mb-4">
                <div class="flex-shrink-0 bg-blue-50 rounded-lg p-3">
                    <svg class="h-6 w-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                    </svg>
                </div>
                <div class="ml-4">
                    <h2 class="text-lg font-semibold text-gray-800">Image Gallery</h2>
                    <p class="text-gray-600 text-sm">Upload and manage images for your website gallery</p>
                </div>
            </div>

            <div class="space-y-6">
                <div>
                    <label for="gallery_image" class="block text-sm font-medium text-gray-700 mb-1">Add Gallery Image</label>
                    <div class="flex space-x-3">
                        <input type="file" id="gallery_image" name="gallery_image" accept="image/*"
                               class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                        <input type="text" id="gallery_caption" name="gallery_caption" 
                               class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white hover:border-gray-400 transition-colors"
                               placeholder="Image caption (optional)">
                    </div>
                </div>
                
                <!-- Existing gallery images -->
                {% if website.content.gallery %}
                <div class="mt-4">
                    <h3 class="text-sm font-medium text-gray-700 mb-3">Gallery Images</h3>
                    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
                        {% for img in website.content.gallery %}
                        <div class="relative group">
                            <div class="aspect-w-1 aspect-h-1 overflow-hidden rounded-lg bg-gray-100">
                                <img src="{{ img.image }}" alt="Gallery image" class="object-cover">
                                {% if img.caption %}
                                <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-40 transition-opacity flex items-end">
                                    <p class="text-white p-2 opacity-0 group-hover:opacity-100 transition-opacity text-xs">
                                        {{ img.caption }}
                                    </p>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Banner Images -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <div class="flex items-start mb-4">
                <div class="flex-shrink-0 bg-blue-50 rounded-lg p-3">
                    <svg class="h-6 w-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 14h16M4 10h16M4 6h16M4 18h16"/>
                    </svg>
                </div>
                <div class="ml-4">
                    <h2 class="text-lg font-semibold text-gray-800">Banner Images</h2>
                    <p class="text-gray-600 text-sm">Add hero banners to your website</p>
                </div>
            </div>

            <div class="space-y-6">
                <div>
                    <label for="banner_image" class="block text-sm font-medium text-gray-700 mb-1">Add New Banner Image</label>
                    <input type="file" id="banner_image" name="banner_image" accept="image/*"
                           class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                    <p class="mt-1 text-sm text-gray-500">Recommended size: 1920x1080px</p>
                </div>
                
                <!-- Existing banners -->
                {% if website.content.hero_banners %}
                <div class="mt-4">
                    <h3 class="text-sm font-medium text-gray-700 mb-3">Existing Banners</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                        {% for banner in website.content.hero_banners %}
                        <div class="border border-gray-200 rounded-md overflow-hidden">
                            <img src="{{ banner.image }}" alt="Banner" class="w-full h-32 object-cover">
                            <div class="p-3">
                                {% if banner.title %}
                                <h4 class="text-sm font-medium text-gray-900">{{ banner.title }}</h4>
                                {% endif %}
                                {% if banner.description %}
                                <p class="text-xs text-gray-500 mt-1">{{ banner.description }}</p>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Slider Section -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <div class="flex items-start mb-4">
                <div class="flex-shrink-0 bg-blue-50 rounded-lg p-3">
                    <svg class="h-6 w-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/>
                    </svg>
                </div>
                <div class="ml-4">
                    <h2 class="text-lg font-semibold text-gray-800">Slider</h2>
                    <p class="text-gray-600 text-sm">Manage your website's slider content</p>
                </div>
                <div class="ml-auto">
                    <button type="button" id="add-slide" 
                            class="inline-flex items-center px-3 py-1.5 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200">
                        <svg class="h-4 w-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                        </svg>
                        Add Slide
                    </button>
                </div>
            </div>

            <div id="slides-container" class="space-y-4">
                {% if website.content.slides %}
                    {% for slide in website.content.slides %}
                    <div class="slide-container border border-gray-200 rounded-lg p-4 bg-gray-50">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-base font-medium text-gray-900">Slide <span class="slide-number">{{ forloop.counter }}</span></h3>
                            <div class="flex space-x-2">
                                <button type="button" class="move-slide-up p-1 text-gray-500 hover:text-gray-700 focus:outline-none">
                                    <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"/>
                                    </svg>
                                </button>
                                <button type="button" class="move-slide-down p-1 text-gray-500 hover:text-gray-700 focus:outline-none">
                                    <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                    </svg>
                                </button>
                                <button type="button" class="remove-slide p-1 text-red-500 hover:text-red-700 focus:outline-none">
                                    <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <div class="mb-3">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Slide Heading</label>
                                    <input type="text" class="slide-heading block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm" value="{{ slide.heading }}">
                                </div>
                                <div class="mb-3">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Slide Subheading</label>
                                    <input type="text" class="slide-subheading block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm" value="{{ slide.subheading }}">
                                </div>
                                <div class="mb-3">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Slide Content</label>
                                    <textarea class="slide-content block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm resize-y" rows="3">{{ slide.content }}</textarea>
                                </div>
                                <div class="grid grid-cols-2 gap-3">
                                    <div class="mb-3">
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Button Text</label>
                                        <input type="text" class="slide-button-text block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm" value="{{ slide.button_text }}">
                                    </div>
                                    <div class="mb-3">
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Button URL</label>
                                        <input type="text" class="slide-button-url block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm" value="{{ slide.button_url }}">
                                    </div>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Slide Image</label>
                                {% if slide.image %}
                                <div class="mb-3">
                                    <img src="{{ slide.image }}" class="current-slide-image max-h-48 w-auto rounded mb-2" data-image-url="{{ slide.image }}" alt="Current slide image">
                                </div>
                                {% endif %}
                                <input type="file" class="slide-image block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100" accept="image/*">
                                <div class="slide-image-preview mt-2"></div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                {% endif %}
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="sticky bottom-0 bg-white border-t border-gray-200 py-4 px-6 -mx-4">
            <div class="flex justify-between items-center">
                <div class="text-sm text-gray-500">
                    <span id="bottom-save-status" class="inline-flex items-center">
                        <svg class="h-4 w-4 text-green-500 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                        <span class="status-text">Changes are saved automatically</span>
                    </span>
                </div>
                <div class="flex space-x-4">
                    <a href="{% url 'dashboard' %}" 
                            class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200">
                        Back to Dashboard
                    </a>
                    <a href="{% url 'preview_website' website.id %}" target="_blank" 
                            class="inline-flex items-center px-6 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200">
                        <svg class="h-4 w-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                        </svg>
                        View Your Website
                    </a>
                </div>
            </div>
        </div>
    </form>
</div>

<script>
// Slider functionality
let getSlideData; // Declare the function in global scope

function initSliderFunctionality() {
    const slidesContainer = document.getElementById('slides-container');
    const addSlideBtn = document.getElementById('add-slide');
    const slideTemplate = document.getElementById('slide-template');
    
    // Add a new slide
    addSlideBtn.addEventListener('click', function() {
        const slideCount = slidesContainer.querySelectorAll('.slide-container').length;
        const newSlideContent = slideTemplate.innerHTML.replace(/{index}/g, slideCount + 1);
        const newSlideContainer = document.createElement('div');
        newSlideContainer.innerHTML = newSlideContent;
        slidesContainer.appendChild(newSlideContainer.firstElementChild);
        updateSlideNumbers();
        bindSlideEvents(slidesContainer.lastElementChild);
    });
    
    // Bind events to existing slides
    const existingSlides = slidesContainer.querySelectorAll('.slide-container');
    existingSlides.forEach(slide => {
        bindSlideEvents(slide);
    });
    
    // Update slide numbers
    function updateSlideNumbers() {
        const slides = slidesContainer.querySelectorAll('.slide-container');
        slides.forEach((slide, index) => {
            slide.querySelector('.slide-number').textContent = index + 1;
        });
    }
    
    // Bind events to a slide
    function bindSlideEvents(slideEl) {
        // Remove slide
        const removeBtn = slideEl.querySelector('.remove-slide');
        removeBtn.addEventListener('click', function() {
            if (confirm('Are you sure you want to remove this slide?')) {
                slideEl.remove();
                updateSlideNumbers();
            }
        });
        
        // Move slide up
        const upBtn = slideEl.querySelector('.move-slide-up');
        upBtn.addEventListener('click', function() {
            const prevSlide = slideEl.previousElementSibling;
            if (prevSlide) {
                slidesContainer.insertBefore(slideEl, prevSlide);
                updateSlideNumbers();
            }
        });
        
        // Move slide down
        const downBtn = slideEl.querySelector('.move-slide-down');
        downBtn.addEventListener('click', function() {
            const nextSlide = slideEl.nextElementSibling;
            if (nextSlide) {
                slidesContainer.insertBefore(nextSlide, slideEl);
                updateSlideNumbers();
            }
        });
        
        // Image preview
        const imageInput = slideEl.querySelector('.slide-image');
        const imagePreview = slideEl.querySelector('.slide-image-preview');
        
        imageInput.addEventListener('change', function() {
            if (this.files && this.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.classList.add('max-h-48', 'w-auto', 'rounded', 'mt-2');
                    imagePreview.innerHTML = '';
                    imagePreview.appendChild(img);
                }
                reader.readAsDataURL(this.files[0]);
            }
        });
    }
    
    // Collect slide data for form submission
    getSlideData = function() {
        const slides = [];
        const slideElements = slidesContainer.querySelectorAll('.slide-container');
        
        slideElements.forEach(slide => {
            const slideData = {
                heading: slide.querySelector('.slide-heading')?.value || '',
                subheading: slide.querySelector('.slide-subheading')?.value || '',
                content: slide.querySelector('.slide-content')?.value || '',
                button_text: slide.querySelector('.slide-button-text')?.value || '',
                button_url: slide.querySelector('.slide-button-url')?.value || ''
            };
            
            // Get image URL for existing slides
            const currentImage = slide.querySelector('.current-slide-image');
            if (currentImage) {
                slideData.image = currentImage.dataset.imageUrl;
            }
            
            slides.push(slideData);
        });
        
        return slides;
    };
}

document.addEventListener('DOMContentLoaded', function() {
    // Initialize slider functionality
    initSliderFunctionality();
    
    const form = document.getElementById('editWebsiteForm');
    const messagesContainer = document.getElementById('messages-container');
    const autoSaveIndicator = document.getElementById('auto-save-indicator');
    const autoSaveText = document.getElementById('auto-save-text');
    
    // Debounce function to limit how often a function can be called
    function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }
    
    // Save form data function
    function saveFormData() {
        showAutoSaveIndicator('Saving...');
        updateBottomStatus('Saving changes...', 'blue');
        
        const formData = new FormData(form);
        const content = {};
        
        // Process standard form fields (not files)
        formData.forEach((value, key) => {
            if (!key.startsWith('csrf') && 
                !key.endsWith('_logo') && 
                !key.endsWith('_image') && 
                !key.endsWith('_file') && 
                !key.endsWith('_document') && 
                key !== 'document' && 
                key !== 'document_name' && 
                key !== 'gallery_image' && 
                key !== 'gallery_caption' && 
                key !== 'banner_image') {
                content[key] = value;
            }
        });
        
        // Add slider content
        if (document.getElementById('slides-container')) {
            const slides = getSlideData();
            content.slides = slides;
        }
        
        // Add checkbox values for logo removal
        ['remove_desktop_logo', 'remove_mobile_logo', 'remove_favicon'].forEach(key => {
            if (formData.has(key)) {
                content[key] = formData.get(key) === 'true';
            }
        });
        
        // Add content as JSON
        const dataToSend = new FormData();
        dataToSend.set('content', JSON.stringify(content));
        dataToSend.set('csrfmiddlewaretoken', formData.get('csrfmiddlewaretoken'));
        
        fetch(window.location.href, {
            method: 'POST',
            body: dataToSend,
            headers: {
                'X-CSRFToken': formData.get('csrfmiddlewaretoken')
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                showAutoSaveIndicator('Saved', false);
                updateBottomStatus('All changes saved', 'green');
                setTimeout(() => {
                    hideAutoSaveIndicator();
                }, 2000);
            } else {
                showAutoSaveIndicator('Save failed', false);
                updateBottomStatus('Failed to save changes', 'red');
                setTimeout(() => {
                    hideAutoSaveIndicator();
                    updateBottomStatus('Changes are saved automatically', 'green');
                }, 3000);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showAutoSaveIndicator('Save failed', false);
            updateBottomStatus('Failed to save changes', 'red');
            setTimeout(() => {
                hideAutoSaveIndicator();
                updateBottomStatus('Changes are saved automatically', 'green');
            }, 3000);
        });
    }
    
    // Function to update the bottom save status
    function updateBottomStatus(text, color) {
        const bottomStatus = document.getElementById('bottom-save-status');
        const icon = bottomStatus.querySelector('svg');
        const statusText = bottomStatus.querySelector('.status-text');
        
        // Update the text content
        if (statusText) {
            statusText.textContent = text;
        }
        
        if (color === 'green') {
            icon.classList.remove('text-blue-500', 'text-red-500', 'animate-spin');
            icon.classList.add('text-green-500');
            icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>';
        } else if (color === 'blue') {
            icon.classList.remove('text-green-500', 'text-red-500');
            icon.classList.add('text-blue-500', 'animate-spin');
            icon.innerHTML = '<circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>';
        } else if (color === 'red') {
            icon.classList.remove('text-blue-500', 'text-green-500', 'animate-spin');
            icon.classList.add('text-red-500');
            icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>';
        }
    }
    
    // Auto-save debounced function - will only trigger after 1 second of inactivity
    const debouncedSave = debounce(saveFormData, 1000);
    
    // Show auto-save indicator
    function showAutoSaveIndicator(text, showSpinner = true) {
        autoSaveText.textContent = text;
        autoSaveIndicator.classList.remove('hidden');
        
        // Control spinner visibility
        const spinner = autoSaveIndicator.querySelector('svg');
        if (spinner) {
            if (showSpinner) {
                spinner.classList.remove('hidden');
            } else {
                spinner.classList.add('hidden');
            }
        }
    }
    
    // Hide auto-save indicator
    function hideAutoSaveIndicator() {
        autoSaveIndicator.classList.add('hidden');
    }
    
    // Add event listeners to all form inputs for auto-save
    const textInputs = form.querySelectorAll('input[type="text"], input[type="email"], input[type="tel"], textarea, input[type="checkbox"]');
    textInputs.forEach(input => {
        const eventType = input.type === 'checkbox' ? 'change' : 'input';
        input.addEventListener(eventType, debouncedSave);
    });
    
    // Watch for changes in the slider section
    function addSliderFieldListeners() {
        const slideInputs = document.querySelectorAll('.slide-container input[type="text"], .slide-container textarea');
        slideInputs.forEach(input => {
            input.addEventListener('input', debouncedSave);
        });
        
        // Re-add listeners when a new slide is added
        const addSlideBtn = document.getElementById('add-slide');
        if (addSlideBtn) {
            const originalClickHandler = addSlideBtn.onclick;
            addSlideBtn.onclick = function(e) {
                if (originalClickHandler) {
                    originalClickHandler.call(this, e);
                }
                // Wait a moment for the new slide to be added to the DOM
                setTimeout(() => {
                    const newSlideInputs = document.querySelectorAll('.slide-container:last-child input[type="text"], .slide-container:last-child textarea');
                    newSlideInputs.forEach(input => {
                        input.addEventListener('input', debouncedSave);
                    });
                }, 100);
            };
        }
        
        // Also trigger save when slides are moved or removed
        document.querySelectorAll('.move-slide-up, .move-slide-down, .remove-slide').forEach(btn => {
            btn.addEventListener('click', function() {
                // Delay save to give time for DOM updates
                setTimeout(debouncedSave, 100);
            });
        });
    }
    
    // Initialize slider field listeners
    addSliderFieldListeners();
    
    // Handle form submission for file uploads (these can't be auto-saved)
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const formData = new FormData(form);
        const content = {};
        
        // Process standard form fields (not files)
        formData.forEach((value, key) => {
            if (!key.startsWith('csrf') && 
                !key.endsWith('_logo') && 
                !key.endsWith('_image') && 
                !key.endsWith('_file') && 
                !key.endsWith('_document') && 
                key !== 'document' && 
                key !== 'document_name' && 
                key !== 'gallery_image' && 
                key !== 'gallery_caption' && 
                key !== 'banner_image') {
                content[key] = value;
            }
        });
        
        // Add slider content
        if (document.getElementById('slides-container')) {
            const slides = getSlideData();
            content.slides = slides;
        }
        
        // Add checkbox values for logo removal
        ['remove_desktop_logo', 'remove_mobile_logo', 'remove_favicon'].forEach(key => {
            if (formData.has(key)) {
                content[key] = formData.get(key) === 'true';
            }
        });
        
        // Add content as JSON
        formData.set('content', JSON.stringify(content));
        
        fetch(window.location.href, {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': formData.get('csrfmiddlewaretoken')
            }
        })
        .then(response => response.json())
        .then(data => {
            messagesContainer.innerHTML = '';
            
            const messageDiv = document.createElement('div');
            messageDiv.className = data.status === 'success' 
                ? 'bg-white border-l-4 border-green-500 text-green-700 p-4 rounded-lg shadow-lg mb-4'
                : 'bg-white border-l-4 border-red-500 text-red-700 p-4 rounded-lg shadow-lg mb-4';
            
            const messageContent = document.createElement('div');
            messageContent.className = 'flex items-center';
            
            const icon = document.createElement('div');
            icon.className = 'flex-shrink-0';
            icon.innerHTML = data.status === 'success'
                ? '<svg class="h-5 w-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>'
                : '<svg class="h-5 w-5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>';
            
            const text = document.createElement('p');
            text.className = 'ml-3 text-sm font-medium';
            text.textContent = data.message;
            
            messageContent.appendChild(icon);
            messageContent.appendChild(text);
            messageDiv.appendChild(messageContent);
            messagesContainer.appendChild(messageDiv);
            
            if (data.status === 'success') {
                // If there were uploads or file changes, reload the page
                if (formData.has('desktop_logo') || formData.has('mobile_logo') || 
                    formData.has('favicon') || formData.has('document') || 
                    formData.has('gallery_image') || formData.has('banner_image') ||
                    formData.has('remove_desktop_logo') || formData.has('remove_mobile_logo') || 
                    formData.has('remove_favicon')) {
                    setTimeout(() => {
                        window.location.reload();
                    }, 1500);
                } else if (data.content) {
                    // Just update form fields without reloading
                    Object.entries(data.content).forEach(([key, value]) => {
                        const input = form.querySelector(`[name="${key}"]`);
                        if (input) {
                            input.value = value;
                        }
                    });
                }
            }
            
            setTimeout(() => {
                messageDiv.style.transition = 'opacity 0.5s ease-out';
                messageDiv.style.opacity = '0';
                setTimeout(() => messageDiv.remove(), 500);
            }, 5000);
        })
        .catch(error => {
            console.error('Error:', error);
            messagesContainer.innerHTML = `
                <div class="bg-white border-l-4 border-red-500 text-red-700 p-4 rounded-lg shadow-lg mb-4">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <svg class="h-5 w-5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                            </svg>
                        </div>
                        <p class="ml-3 text-sm font-medium">An error occurred while saving changes. Please try again.</p>
                    </div>
                </div>
            `;
        });
    });
    
    // Generate form fields from schema
    const schema = {{ schema|safe }};
    const content = {{ website.content|safe }};
    const editor = document.getElementById('content-editor');
    
    function generateFormFields(schema, content, prefix = '') {
        let html = '';
        
        for (const [key, value] of Object.entries(schema.properties)) {
            const fieldId = prefix ? `${prefix}_${key}` : key;
            const fieldValue = content[key] || '';
            
            html += `
                <div class="mb-6">
                    <label for="${fieldId}" class="block text-sm font-medium text-gray-700 mb-1">
                        ${value.title || key}
                    </label>
                    ${generateFieldInput(value, fieldId, fieldValue)}
                    ${value.description ? `
                        <p class="mt-1 text-sm text-gray-500">${value.description}</p>
                    ` : ''}
                </div>
            `;
        }
        
        return html;
    }
    
    function generateFieldInput(field, id, value) {
        const baseClasses = "block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white hover:border-gray-400 transition-colors";
        
        switch (field.type) {
            case 'string':
                if (field.format === 'textarea') {
                    return `
                        <div class="relative">
                            <textarea id="${id}" name="${id}" rows="3"
                                class="${baseClasses} resize-y"
                            >${value}</textarea>
                        </div>
                    `;
                }
                return `
                    <div class="relative">
                        <input type="text" id="${id}" name="${id}" value="${value}"
                            class="${baseClasses}">
                    </div>
                `;
            case 'boolean':
                return `
                    <div class="relative flex items-start">
                        <div class="flex items-center h-5">
                            <input type="checkbox" id="${id}" name="${id}" ${value ? 'checked' : ''}
                                class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded transition-colors duration-200">
                        </div>
                        <div class="ml-3 text-sm">
                            <label for="${id}" class="font-medium text-gray-700">${field.title || id}</label>
                        </div>
                    </div>
                `;
            default:
                return `
                    <div class="relative">
                        <input type="text" id="${id}" name="${id}" value="${value}"
                            class="${baseClasses}">
                    </div>
                `;
        }
    }
    
    if (editor) {
        editor.innerHTML = generateFormFields(schema, content);
        
        // Add auto-save functionality to dynamically generated fields
        const dynamicInputs = editor.querySelectorAll('input[type="text"], input[type="email"], input[type="tel"], textarea, input[type="checkbox"]');
        dynamicInputs.forEach(input => {
            const eventType = input.type === 'checkbox' ? 'change' : 'input';
            input.addEventListener(eventType, debouncedSave);
        });
    }
});
</script>

<!-- Slide Template -->
<template id="slide-template">
    <div class="slide-container border border-gray-200 rounded-lg p-4 bg-gray-50">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-base font-medium text-gray-900">Slide <span class="slide-number">{index}</span></h3>
            <div class="flex space-x-2">
                <button type="button" class="move-slide-up p-1 text-gray-500 hover:text-gray-700 focus:outline-none">
                    <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"/>
                    </svg>
                </button>
                <button type="button" class="move-slide-down p-1 text-gray-500 hover:text-gray-700 focus:outline-none">
                    <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                </button>
                <button type="button" class="remove-slide p-1 text-red-500 hover:text-red-700 focus:outline-none">
                    <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                    </svg>
                </button>
            </div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <div class="mb-3">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Slide Heading</label>
                    <input type="text" class="slide-heading block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm" value="">
                </div>
                <div class="mb-3">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Slide Subheading</label>
                    <input type="text" class="slide-subheading block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm" value="">
                </div>
                <div class="mb-3">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Slide Content</label>
                    <textarea class="slide-content block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm resize-y" rows="3"></textarea>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div class="mb-3">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Button Text</label>
                        <input type="text" class="slide-button-text block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm" value="">
                    </div>
                    <div class="mb-3">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Button URL</label>
                        <input type="text" class="slide-button-url block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm" value="">
                    </div>
                </div>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Slide Image</label>
                <input type="file" class="slide-image block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100" accept="image/*">
                <div class="slide-image-preview mt-2"></div>
            </div>
        </div>
    </div>
</template>
{% endblock %} 